require.config({
	paths : {
		"jquery" : "jquery-1.11.3",
		"cookie" : "jquery.cookie"
	}
})

//封装模块
require(['jquery','cookie'],function($,cookie){
	
	/*-----页面头部搜索框-------*/
$(function(){
	
	$(".butsearch").keyup(function(evt){
		//alert($(this));
		$('.but ul').html('');
		var $sc = $('<script></script>');
		$sc.attr('src',"https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/su?wd=" + $(this).val() + "&cb=fn");
		$("head").append($sc);
		evt.stopPropagation();
	})
	$('.but ul').on({
		'mouseenter' : function(){
			$(this).css('background','burlywood');
		},
		'mouseleave' : function(){
			$(this).css('background','');
		},
		'click' : function(){
			$('.butsearch').val($(this).html());
			$('.but ul').css('display','none');
		}
	},'li');
	
	$(".butsearch").focus(function(){
		$('.but ul').html('');
		$('.but ul').css('display','block');
		public();
	})
})
	var $arr = [];
	function fn(data){
		$arr = data.s;
		public();
	}
	function public(){
		for(var i = 0;i < $arr.length;i ++){
			let li = document.createElement('li');
			li.innerHTML = $arr[i];
			$('.but ul').append(li);
		}
	}
	
	
	
/*------首页轮播图-------*/
//$(function(){
//	$.getJSON('../json/json2.json',function(data){
//		var arr = data.banner;
//		var str;
//		for(var i = 0,len = arr.length;i < len;i ++){
//			str = `<li><a href=""><img src="${arr[i].src}" alt="${arr[i].alt}"></a></li>`;
//			$('.banner_c ul').append(str);
//		}
//	})
//})
//轮播函数
function Slider(id){
	this.bigBox = $('#' + id);
	
	this.ullis = $('.banner_c ul li');
//	console.log(typeof this.ullis);
	//大图数量
	this.num = this.ullis.length;
	
	//当前轮播的下标
	this.indexA = 0;
	this.timer = null;

	//创建并返回ol中的所有li
	this.ollis = this.screateEle();
//	console.log(this.olLis);
	this.sport();
	this.addEvent();
	this.auto();
}
Slider.prototype = {
	screateEle : function(){
		var arr = [];
		var ol = $("<ol></ol>")
		for(var i = 0;i < this.num;i ++){
			var li = $("<li></li>");
			li.html(i + 1);
			arr.push(li);
			ol.append(li);
		}
		
		this.bigBox.append(ol);
		
		//创建左右按钮
		var leftSpan = $('<span></span>');
		leftSpan.html('&lt;');
		leftSpan.attr('id','ltBtn');
		this.bigBox.append(leftSpan);
		
		var rightSpan = $('<span></span>');
		rightSpan.html('&gt;');
		rightSpan.attr('id','rtBtn');
		this.bigBox.append(rightSpan);
		
		return arr;
	},
	//设置轮播
	sport : function(){
		for(var i = 0;i < this.num;i ++){
			this.ullis[i].style.display = 'none';
			this.ollis[i].css('background','black');
		}
//		console.log(this.ullis)
		//当前大图显示
		this.ullis[this.indexA].style.display = 'block';
		
		//当前原点为蓝色
		this.ollis[this.indexA].css('background','red');
//		console.log(this.ollis[this.indexA]);
	},
	//添加事件
	addEvent : function(){
		var that = this;
		//给小原点添加移入事件
		for(let i = 0;i < this.num;i ++){
			// this.ollis[i].index = i;
			this.ollis[i].mouseenter(function(){
				that.indexA = i;
				that.sport();
			})
		}
		//给左按钮添加点击事件
		$('#ltBtn').click(function(){
			that.indexA --;
			if(that.indexA == -1){
				that.indexA = that.num - 1;
			}
			that.sport();
		})
		//给右按钮添加点击事件
		$('#rtBtn').click(function(){
			that.indexA ++;
			if(that.indexA == that.num){
				that.indexA = 0;
			}
			that.sport();
		})
	},
	//自动轮播
	auto : function(){
		var that = this;
		this.timer = setInterval(function(){
			that.indexA ++;
			 if(that.indexA == that.num){
			 	that.indexA = 0;
			 }
//			that.indexA %= that.num;
			that.sport();
		},5000)
		this.bigBox.mouseenter(function(){
			clearInterval(that.timer);
		})
		this.bigBox.mouseleave(function(){
			that.auto();
		})
	}
}

	$(function(){
		new Slider("slidel");
	})
	
	
	
/*--------main-title----------*/
$(window).scroll(function(){
	var _top = $(document).scrollTop();
//	console.log(_top);
	if(_top >= 650){
		$('.mainNav_b').css({'position':'fixed','top':0,'opacity':0.9,'z-index':100});
	}else{
		$('.mainNav_b').css({'position':'absolute','top':'550px'});
	}
	var $arr = $('.mainNav_c ul li');
	$arr.each(function(i){
		if(_top <= 450){
			$arr.eq(i).attr('class','')
			$arr.eq(0).attr('class','active');
		}else if(_top >= 450 && _top <= 1650){
			$arr.eq(i).attr('class','')
			$arr.eq(1).attr('class','active');
		}else if(_top >= 1650 && _top <= 3500){
			$arr.eq(i).attr('class','')
			$arr.eq(2).attr('class','active');
		}else if(_top >= 3500 && _top <= 4900){
			$arr.eq(i).attr('class','')
			$arr.eq(3).attr('class','active');
		}else if(_top >= 4900 && _top <= 5800){
			$arr.eq(i).attr('class','')
			$arr.eq(4).attr('class','active');
		}else if(_top >= 5800 && _top <= 6400){
			$arr.eq(i).attr('class','')
			$arr.eq(5).attr('class','active');
		}else{
			$arr.eq(i).attr('class','')
			$arr.eq(6).attr('class','active');
		}
	})
	
})
$(function(){
	var $arr = $('.mainNav_c ul li');
	$arr.eq(0).click(function(){
		
		$('html,body').animate({
			scrollTop:0
		},1000)
	})
	$arr.eq(1).click(function(){
		$('html,body').animate({
			scrollTop:451
		},1000)
	})
	$arr.eq(2).click(function(){
		$('html,body').animate({
			scrollTop:1651
		},1000)
	})
	$arr.eq(3).click(function(){
		$('html,body').animate({
			scrollTop:3501
		},1000)
	})
	$arr.eq(4).click(function(){
		$('html,body').animate({
			scrollTop:4901
		},1000)
	})
	$arr.eq(5).click(function(){
		$('html,body').animate({
			scrollTop:5801
		},1000)
	})
	$arr.eq(6).click(function(){
		$('html,body').animate({
			scrollTop:6401
		},1000)
	})
})


/*-----------ajax获取main部分的图片------------*/
$(function(){
	$.getJSON('../json/json2.json',function(data){
		var arr1 = data.main[0].title1;
		var str1;
		for(var i = 0,len = arr1.length;i < len;i ++){
			str1 = `<li>
			<a href=""><img src="${arr1[i].src}" alt="${arr1[i].alt}"></a>
			<h5 class="msg">${arr1[i].alt}</h5>
			</li>`;
			$('.title1_pic ul').append(str1);
		}
		var obj1 = data.main[0].tit;
//		console.log(obj1);
		$('.title1').append(`<img src="${obj1.src}" alt="${obj1.alt}">`);
		
		
		
		var arr2 = data.main[1].title2;
		var str2;
		for(var j = 0,len = arr2.length;j < len;j ++){
			str2 = `<li>
			<a href=""><img src="${arr2[j].src}" alt="${arr2[j].alt}"></a>
			<div><span>${arr2[j].alt}</span><span><font>${arr2[j].hy}</font><font>${arr2[j].price}</font></span></div>
			<div></div></li>`;
			$('.mainBox_c2 .title_pic ul').append(str2);
		}
		var obj2 = data.main[1].tit;
		$('.mainBox_c2 .title').append(`<img src="${obj2.src}" alt="${obj2.alt}">`);
		
		
		var arr3 = data.main[2].title3;
		var str3;
		for(var m = 0,len = arr3.length;m < len;m ++){
			str3 = `<li>
			<a href=""><img src="${arr3[m].src}" alt="${arr3[m].alt}"></a>
			<div><span>${arr3[m].alt}</span><span><font>${arr3[m].hy}</font><font>${arr3[m].price}</font></span></div>
			<div></div></li>`;
			$('.mainBox_c3 .title_pic ul').append(str3);
		}
		var obj3 = data.main[2].tit;
		$('.mainBox_c3 .title').append(`<img src="${obj3.src}" alt="${obj3.alt}">`);
		
		
		var arr4 = data.main[3].title4;
		var str4;
		for(var m = 0,len = arr4.length;m < len;m ++){
			str4 = `<li>
			<a href=""><img src="${arr4[m].src}" alt="${arr4[m].alt}"></a>
			<div><span>${arr4[m].alt}</span><span><font>${arr4[m].hy}</font><font>${arr4[m].price}</font></span></div>
			<div></div></li>`;
			$('.mainBox_c4 .title_pic ul').append(str4);
		}
		var obj4 = data.main[3].tit;
		$('.mainBox_c4 .title').append(`<img src="${obj4.src}" alt="${obj4.alt}">`);
		
		
		var arr5 = data.main[4].title5;
		var str5;
		for(var m = 0,len = arr5.length;m < len;m ++){
			str5 = `<li>
			<a href=""><img src="${arr5[m].src}" alt="${arr5[m].alt}"></a>
			<div><span>${arr5[m].alt}</span><span><font>${arr5[m].hy}</font><font>${arr5[m].price}</font></span></div>
			<div></div></li>`;
			$('.mainBox_c5 .title_pic ul').append(str5);
		}
		var obj5 = data.main[4].tit;
		$('.mainBox_c5 .title').append(`<img src="${obj5.src}" alt="${obj5.alt}">`);
		
		
		var arr6 = data.main[5].title6;
		var str6;
		for(var m = 0,len = arr6.length;m < len;m ++){
			str6 = `<li>
			<a href=""><img src="${arr6[m].src}" alt="${arr6[m].alt}"></a>
			<div><span>${arr6[m].alt}</span><span><font>${arr6[m].hy}</font><font>${arr6[m].price}</font></span></div>
			<div></div></li>`;
			$('.mainBox_c6 .title_pic ul').append(str6);
		}
		var obj6 = data.main[5].tit;
		$('.mainBox_c6 .title').append(`<img src="${obj6.src}" alt="${obj6.alt}">`);
	})
})


/*----登录后的顶部-----*/
	$(function(){
		var cookieStr = $.cookie('msg');
		var cookieObj = convertCookieStrToCookieObj(cookieStr);
		for(us in cookieObj){
			$('.yhm').html(us);
		}
	})
	function convertCookieStrToCookieObj(str){
		if(!str){
			return {};
		}
		return JSON.parse(str);
	}
	
	
	//购物车
	$('.cart_info_right').click(function(){
		location.href = 'cart.html';
	})
	$(function(){
		var cartStr = $.cookie('mycart') ? $.cookie('mycart') : "";
		if(!cartStr){
			$('.blank').css('display','block');
		}else{
			$('.blank').css('display','none');
			var cartObj = convertcartStrTocartObj(cartStr);
			for(var id in cartObj){
				var good = cartObj[id];
				var str = `
					<tr data-good-id='${good.id}'>
						<td width="60px" height="40"><img src='${good.src}' alt='' style='width:30px;height:30px;margin-left:20px;'/></td>
						<td width="250px" align="center">${good.name}</td>
						<td width="100px" style='padding-left:20px;color:red;'>${good.price} x ${good.num}</td>
					</tr>
				`;
				$('#tab').append(str);
				var num = 0;
				for(var i in cartObj){
					num += cartObj[i].num;
				}
				$('.sbuy').html(`购物车中有${num}件商品`);
				$('.sum').html(`￥${good.price * num}`);
				$('#buy').html(`购物车${num}件`);
			}
		}
	})
	function convertcartStrTocartObj(str){
		if(!str){
			return {};
		}
		return JSON.parse(str);
	}
	
})
