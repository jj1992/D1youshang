
require.config({
	paths : {
		"jquery" : "jquery-1.11.3",
		"cookie" : "jquery.cookie"
	}
})

//封装模块
require(['jquery','cookie'],function($,cookie){

	//验证码
	$(function(){
		$('.yzm').html('1314');
		$('.renovate').click(function(){
			var colors = (Math.floor(Math.random() * 0xffffff).toString(16)); 
			var str = '';
			for(var i = 0;i < 4;i ++){
					str += Math.floor(Math.random() * 10) || String.fromCharCode(Math.floor(Math.random() * (122 - 97 + 1)) + 97) || String.fromCharCode(Math.floor(Math.random() * (90 - 65 + 1)) + 65);
				}
			$('.yzm').html(str);
			$('.yzm').css('background',"#" + colors);
		})
	})
	
	//正则
	
	$(function(){
		var $ipt = $('.reg_main input');
		var $b = $('.reg_main b');
		var $em = $('.reg_main em');
		var off = false;
		var off1 = false;
		//电话
		$ipt.eq(0).blur(function(){
			var re = /1(3|5|7|8|4|6|9)[\d]{9}/;
			var str = $ipt.eq(0).val();
			if(re.test(str) == false || str == ''){
				$b.eq(0).css('display','none');
				$em.eq(0).css('display','inline-block');
			}else{
				$b.eq(0).css('display','inline-block');
				$em.eq(0).css('display','none');
			}
			
			var name = $('#tel').val();
			var cookieStr = $.cookie('msg') ? $.cookie('msg') : "";
			var cookieObj = convertCookieStrToCookieObj(cookieStr);
			if(name in cookieObj){
//				alert('用户名已存在!');
				$('.spa').css('display','inline-block');
				$ipt.eq(0).val('');
				$b.eq(0).css('display','none');
			}else{
				$('.spa').css('display','none');
			}
		})
		//手机验证码
		$ipt.eq(2).blur(function(){
			var re = /\d{4}/;
			var str = $ipt.eq(2).val();
			if(re.test(str) == false || str == ''){
				$em.eq(1).css('display','inline-block');
				$b.eq(1).css('display','none');
			}else{
				$em.eq(1).css('display','none');
				$b.eq(1).css('display','none');
			}
		})
		$ipt.eq(2).focus(function(){
			$b.eq(1).css('display','inline-block');
			$em.eq(1).css('display','none');
		})
		//性别
		var $offon1 = true;
		var $offon2 = true;
		$ipt.eq(3).checked = $offon1
		$ipt.eq(4).checked = $offon2
		$ipt.eq(3).click(function(){
			if($offon1){
				$b.eq(2).css('display','inline-block');
				$em.eq(2).css('display','none');
			}else{
				$b.eq(2).css('display','none');
				$em.eq(2).css('display','inline-block');
			}
			$offon1 = !$offon1;
		})
		
		$ipt.eq(4).click(function(){
			if($offon2){
				$b.eq(2).css('display','inline-block');
				$em.eq(2).css('display','none');
			}else{
				$b.eq(2).css('display','none');
				$em.eq(2).css('display','inline-block');
			}
			$offon2 = !$offon2;
		})
		
		//设置密码
		$ipt.eq(5).blur(function(){
			var re = /[a-zA-Z0-9!@#_*]{6,14}/;
			var str = $ipt.eq(5).val();
			if(re.test(str) == false || str == ''){
				$em.eq(3).css('display','inline-block');
				$b.eq(3).css('display','none');
			}else{
				$em.eq(3).css('display','none');
				$b.eq(3).css('display','inline-block');
			}
		})
		//确认密码
		$ipt.eq(6).blur(function(){
			var str = $ipt.eq(6).val()
			if(str != $ipt.eq(5).val() || str == ''){
				$em.eq(4).css('display','inline-block');
				$b.eq(4).css('display','none');
			}else{
				$em.eq(4).css('display','none');
				$b.eq(4).css('display','inline-block');
			}
		})
		//注册
		$("#register_btn").click(function(){
			$ipt.each(function(i){
				if($ipt[i].value != ''){
					off = true;
					
				}else{
					off = false;
				}
			})
			$em.each(function(i){
				if($em[i].style.display == 'none'){
					off1 = true;
				}else{
					off1 = false;
				}
			})
			if(off && off1){ 
				mycookie();
				location.href = 'login.html';
			}else{
				alert('完善');
			}
		})
	})
//	mycookie();
	function mycookie(){
		var name = $('#tel').val();
		var pwd = $('#pwd').val();
		
		var cookieStr = $.cookie('msg') ? $.cookie('msg') : "";
//		console.log(cookieStr)
		var cookieObj = convertCookieStrToCookieObj(cookieStr);
//		console.log(cookieObj)
		if(name in cookieObj){
			alert('用户名已存在!');
		}else{
			cookieObj[name] = {
				"pwd" : pwd
			}
		}
		$.cookie('msg',JSON.stringify(cookieObj),{expires : 7,path : '/'});
		console.log($.cookie('msg'));
	}
	function convertCookieStrToCookieObj(str){
		if(!str){
			return {};
		}
		return JSON.parse(str);
	}

})
